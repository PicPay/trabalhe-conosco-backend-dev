version: '3'

services:
  app_web:
    image: mateusvtt/nodejs:6.11.2
    container_name: app_picpay
    hostname: app_picpay
    restart: always
    volumes:
      - ./volumes/app/:/app
    ports:
      - "3000:80"
    networks:
      - public
      - private
    logging:
     driver: syslog
     options:
      syslog-facility: daemon
      tag: APP_PICPAY_WEB

  mongo-seed:
    build: ./docker-images/mongo-seed
    volumes:
     - ./volumes/mongo-seed/:/mongo-seed
    links:
      - app_mongodb:db
    networks:
     - private
    logging:
     driver: syslog
     options:
      syslog-facility: daemon
      tag: APP_PICPAY_MONGO-SEED

  app_mongodb:
    image: mateusvtt/mongo:3.4.6
    restart: always
    container_name: app_picpay_mongodb
    volumes:
     - ./volumes/mongodb:/data/db
    networks:
     - private
    logging:
     driver: syslog
     options:
      syslog-facility: daemon
      tag: APP_PICPAY_MONGODB

networks:
  public:
    driver: bridge
  private:
    internal: true
    driver: bridge

#comando para import
#mongoimport -d picpay -c users --type csv --file users.csv --fields "id,name,username"
#db.users.update({},{\$set: {lista1: 0,lista2: 0, tags: []}},{multi:true})
#db.users.createIndex( { ids: 1, tags: 1 } )
